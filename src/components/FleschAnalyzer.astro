---

---

<div class="space-y-6">
  <!-- Text Input -->
  <div>
    <label for="text-input" class="mb-2 block text-lg font-medium dark:text-white">
      Geben Sie Ihren Text ein:
    </label>
    <textarea
      id="text-input"
      rows="8"
      class="w-full rounded-lg border border-gray-300 bg-white p-4 text-base focus:border-blue-500 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:placeholder-gray-400"
      placeholder="Fügen Sie hier Ihren Text ein, um die Lesbarkeit zu analysieren..."
    ></textarea>
    <div class="mt-2 flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
      <span id="word-hint">Für zuverlässige Ergebnisse mindestens 30 Wörter.</span>
      <span id="live-word-count">0 Wörter</span>
    </div>
  </div>

  <!-- Results Container -->
  <div id="results" class="hidden space-y-6">

    <!-- Main Score with Gauge - Deutsche Amstad-Formel -->
    <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800">
      <h2 class="mb-2 text-center text-xl font-bold dark:text-white">Flesch-Index (Amstad)</h2>
      <p class="mb-4 text-center text-sm text-gray-500 dark:text-gray-400">Deutsche Formel nach Toni Amstad (1978)</p>

      <!-- Gauge -->
      <div class="relative mx-auto mb-4 h-32 w-64">
        <svg viewBox="0 0 200 100" class="w-full">
          <!-- Background arc -->
          <path
            d="M 20 90 A 80 80 0 0 1 180 90"
            fill="none"
            stroke="#e5e7eb"
            stroke-width="12"
            stroke-linecap="round"
            class="dark:stroke-gray-700"
          />
          <!-- Colored segments -->
          <path d="M 20 90 A 80 80 0 0 1 46 34" fill="none" stroke="#dc2626" stroke-width="12" stroke-linecap="round" />
          <path d="M 46 34 A 80 80 0 0 1 100 10" fill="none" stroke="#ea580c" stroke-width="12" />
          <path d="M 100 10 A 80 80 0 0 1 154 34" fill="none" stroke="#eab308" stroke-width="12" />
          <path d="M 154 34 A 80 80 0 0 1 180 90" fill="none" stroke="#22c55e" stroke-width="12" stroke-linecap="round" />
          <!-- Needle -->
          <line id="gauge-needle" x1="100" y1="90" x2="100" y2="25" stroke="#1f2937" stroke-width="3" stroke-linecap="round" class="origin-bottom transition-transform duration-700 dark:stroke-white" style="transform-origin: 100px 90px;" />
          <circle cx="100" cy="90" r="6" fill="#1f2937" class="dark:fill-white" />
        </svg>
        <div class="absolute inset-x-0 bottom-0 text-center">
          <span id="score-display" class="text-4xl font-bold dark:text-white">--</span>
        </div>
      </div>

      <p id="interpretation" class="text-center text-lg text-gray-600 dark:text-gray-300">--</p>
    </div>

    <!-- Additional Metrics - 2x2 Grid -->
    <div class="grid gap-4 sm:grid-cols-2">
      <!-- Flesch-Kincaid Grade Level -->
      <div class="rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800">
        <h3 class="mb-2 text-sm font-medium text-gray-500 dark:text-gray-400">Flesch-Kincaid Grade Level</h3>
        <div id="kincaid-score" class="text-2xl font-bold dark:text-white">--</div>
        <p id="kincaid-interpretation" class="text-sm text-gray-600 dark:text-gray-300">--</p>
      </div>

      <!-- Wiener Sachtextformel -->
      <div class="rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800">
        <h3 class="mb-2 text-sm font-medium text-gray-500 dark:text-gray-400">Wiener Sachtextformel</h3>
        <div id="wiener-score" class="text-2xl font-bold dark:text-white">--</div>
        <p id="wiener-interpretation" class="text-sm text-gray-600 dark:text-gray-300">--</p>
      </div>

      <!-- Gunning-Fog -->
      <div class="rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800">
        <h3 class="mb-2 text-sm font-medium text-gray-500 dark:text-gray-400">Gunning-Fog-Index</h3>
        <div id="fog-score" class="text-2xl font-bold dark:text-white">--</div>
        <p id="fog-interpretation" class="text-sm text-gray-600 dark:text-gray-300">--</p>
      </div>

      <!-- LIX -->
      <div class="rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800">
        <h3 class="mb-2 text-sm font-medium text-gray-500 dark:text-gray-400">LIX Lesbarkeitsindex</h3>
        <div id="lix-score" class="text-2xl font-bold dark:text-white">--</div>
        <p id="lix-interpretation" class="text-sm text-gray-600 dark:text-gray-300">--</p>
      </div>
    </div>

    <!-- Statistics Grid -->
    <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800">
      <h3 class="mb-4 font-medium dark:text-white">Textstatistiken</h3>
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        <div class="rounded-lg bg-gray-50 p-3 dark:bg-gray-700">
          <div class="text-xs text-gray-500 dark:text-gray-400">Wörter</div>
          <div id="word-count" class="text-xl font-semibold dark:text-white">--</div>
        </div>
        <div class="rounded-lg bg-gray-50 p-3 dark:bg-gray-700">
          <div class="text-xs text-gray-500 dark:text-gray-400">Sätze</div>
          <div id="sentence-count" class="text-xl font-semibold dark:text-white">--</div>
        </div>
        <div class="rounded-lg bg-gray-50 p-3 dark:bg-gray-700">
          <div class="text-xs text-gray-500 dark:text-gray-400">Silben</div>
          <div id="syllable-count" class="text-xl font-semibold dark:text-white">--</div>
        </div>
        <div class="rounded-lg bg-gray-50 p-3 dark:bg-gray-700">
          <div class="text-xs text-gray-500 dark:text-gray-400">Wörter pro Satz</div>
          <div id="words-per-sentence" class="text-xl font-semibold dark:text-white">--</div>
        </div>
        <div class="rounded-lg bg-gray-50 p-3 dark:bg-gray-700">
          <div class="text-xs text-gray-500 dark:text-gray-400">Silben pro Wort</div>
          <div id="syllables-per-word" class="text-xl font-semibold dark:text-white">--</div>
        </div>
        <div class="rounded-lg bg-gray-50 p-3 dark:bg-gray-700">
          <div class="text-xs text-gray-500 dark:text-gray-400">Verschiedene Wörter</div>
          <div id="unique-words" class="text-xl font-semibold dark:text-white">--</div>
        </div>
      </div>
    </div>

    <!-- Sentence Analysis -->
    <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800">
      <h3 class="mb-4 font-medium dark:text-white">Satzanalyse</h3>
      <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">
        Sätze eingefärbt nach Lesbarkeit:
        <span class="inline-block rounded bg-green-100 px-2 py-0.5 text-green-800 dark:bg-green-900 dark:text-green-200">leicht</span>
        <span class="inline-block rounded bg-yellow-100 px-2 py-0.5 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">mittel</span>
        <span class="inline-block rounded bg-red-100 px-2 py-0.5 text-red-800 dark:bg-red-900 dark:text-red-200">schwer</span>
      </p>
      <div id="sentence-analysis" class="leading-relaxed dark:text-gray-200">
        <!-- Sentences will be inserted here -->
      </div>
    </div>

    <!-- Warning -->
    <div id="warning" class="hidden rounded-lg border border-yellow-200 bg-yellow-50 p-4 text-yellow-800 dark:border-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200">
      Achtung: Für zuverlässigere Ergebnisse empfehlen wir einen längeren Text (mindestens 30 Wörter).
    </div>
  </div>
</div>

<script>
  import { analyzeText, type Difficulty, type FullAnalysisResult } from '../utils/flesch';

  const textInput = document.getElementById('text-input') as HTMLTextAreaElement;
  const results = document.getElementById('results');
  const warning = document.getElementById('warning');
  const liveWordCount = document.getElementById('live-word-count');

  const difficultyColors: Record<Difficulty, { text: string; bg: string }> = {
    'sehr-schwer': { text: 'text-red-800 dark:text-red-200', bg: 'bg-red-100 dark:bg-red-900/50' },
    'schwer': { text: 'text-orange-800 dark:text-orange-200', bg: 'bg-orange-100 dark:bg-orange-900/50' },
    'mittelschwer': { text: 'text-yellow-800 dark:text-yellow-200', bg: 'bg-yellow-100 dark:bg-yellow-900/50' },
    'mittel': { text: 'text-lime-800 dark:text-lime-200', bg: 'bg-lime-100 dark:bg-lime-900/50' },
    'leicht': { text: 'text-green-800 dark:text-green-200', bg: 'bg-green-100 dark:bg-green-900/50' },
    'sehr-leicht': { text: 'text-emerald-800 dark:text-emerald-200', bg: 'bg-emerald-100 dark:bg-emerald-900/50' },
    'extrem-leicht': { text: 'text-teal-800 dark:text-teal-200', bg: 'bg-teal-100 dark:bg-teal-900/50' },
  };

  const scoreTextColors: Record<Difficulty, string> = {
    'sehr-schwer': 'text-red-600 dark:text-red-400',
    'schwer': 'text-orange-600 dark:text-orange-400',
    'mittelschwer': 'text-yellow-600 dark:text-yellow-400',
    'mittel': 'text-lime-600 dark:text-lime-400',
    'leicht': 'text-green-600 dark:text-green-400',
    'sehr-leicht': 'text-emerald-600 dark:text-emerald-400',
    'extrem-leicht': 'text-teal-600 dark:text-teal-400',
  };

  function updateGaugeNeedle(score: number) {
    const needle = document.getElementById('gauge-needle');
    if (!needle) return;

    // Score von 0-100 auf Winkel -90 bis 90 Grad mappen
    const clampedScore = Math.max(0, Math.min(100, score));
    const angle = -90 + (clampedScore / 100) * 180;
    needle.style.transform = `rotate(${angle}deg)`;
  }

  function countWords(text: string): number {
    return text.trim().split(/\s+/).filter(w => w.length > 0).length;
  }

  function updateAnalysis() {
    const text = textInput.value.trim();
    const wordCount = countWords(text);

    // Live word count update
    if (liveWordCount) {
      liveWordCount.textContent = `${wordCount} Wörter`;
    }

    if (text.length === 0 || wordCount < 3) {
      results?.classList.add('hidden');
      return;
    }

    const analysis = analyzeText(text);

    // Show results
    results?.classList.remove('hidden');

    // Update Flesch-Amstad score and gauge (deutsche Formel)
    const scoreDisplay = document.getElementById('score-display');
    if (scoreDisplay) {
      scoreDisplay.textContent = analysis.flesch.scoreAmstad.toString();
      scoreDisplay.className = `text-4xl font-bold ${scoreTextColors[analysis.flesch.difficultyAmstad]}`;
    }
    updateGaugeNeedle(Math.max(0, analysis.flesch.scoreAmstad));

    const interpretation = document.getElementById('interpretation');
    if (interpretation) {
      interpretation.textContent = analysis.flesch.interpretationAmstad;
    }

    // Update Flesch-Kincaid
    document.getElementById('kincaid-score')!.textContent = analysis.fleschKincaid.gradeLevel.toString();
    document.getElementById('kincaid-interpretation')!.textContent = analysis.fleschKincaid.interpretation;

    // Update additional metrics
    document.getElementById('wiener-score')!.textContent = analysis.wiener.score.toString();
    document.getElementById('wiener-interpretation')!.textContent = analysis.wiener.interpretation;

    document.getElementById('fog-score')!.textContent = analysis.gunningFog.score.toString();
    document.getElementById('fog-interpretation')!.textContent = analysis.gunningFog.interpretation;

    document.getElementById('lix-score')!.textContent = analysis.lix.score.toString();
    document.getElementById('lix-interpretation')!.textContent = analysis.lix.interpretation;

    // Update statistics
    document.getElementById('word-count')!.textContent = analysis.flesch.wordCount.toString();
    document.getElementById('sentence-count')!.textContent = analysis.flesch.sentenceCount.toString();
    document.getElementById('syllable-count')!.textContent = analysis.flesch.syllableCount.toString();
    document.getElementById('words-per-sentence')!.textContent = analysis.flesch.avgWordsPerSentence.toString();
    document.getElementById('syllables-per-word')!.textContent = analysis.flesch.avgSyllablesPerWord.toString();
    document.getElementById('unique-words')!.textContent = analysis.flesch.uniqueWords.toString();

    // Update sentence analysis with colored sentences
    const sentenceContainer = document.getElementById('sentence-analysis');
    if (sentenceContainer) {
      sentenceContainer.innerHTML = analysis.sentences.map(sentence => {
        const colors = difficultyColors[sentence.difficulty];
        return `<span class="inline rounded px-1 py-0.5 ${colors.bg} ${colors.text}" title="Score: ${sentence.score}, Wörter: ${sentence.wordCount}">${sentence.text}</span>`;
      }).join(' ');
    }

    // Warning for short texts
    if (analysis.flesch.wordCount < 30) {
      warning?.classList.remove('hidden');
    } else {
      warning?.classList.add('hidden');
    }
  }

  // Debounce function for real-time analysis
  let debounceTimer: ReturnType<typeof setTimeout>;
  function debounce(func: () => void, delay: number) {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(func, delay);
  }

  // Real-time analysis on input
  textInput?.addEventListener('input', () => {
    debounce(updateAnalysis, 300);
  });

  // Initial analysis if there's text
  if (textInput?.value.trim()) {
    updateAnalysis();
  }
</script>
